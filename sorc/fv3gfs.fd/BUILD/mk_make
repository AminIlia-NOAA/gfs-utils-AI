#!/bin/csh

set root = $PWD

if ( ${2} == "clean" || ${3} == "clean" ) then
  echo " cleaning build directory in 4 seconds "
  sleep 4
  (cd exec ; \rm -f *.f90 *.o *.mod test.x)
endif

#-- load the development environment
source ../site/env.cshrc
module list

ifort -V 

#ADD TO MAKEFILE
# NCEPLIBS = -L../nceplibs/  -lbacio_8  -lsp_v2.0.2_d  -lw3emc_d  -lw3nco_d
# 
#test.x: $(OBJ) 
#	$(LD) $(OBJ) $(NCEPLIBS) -o test.x  $(LDFLAGS)


set NCEPLIBS = "./libgfs.a -L../nceplibs/  -lbacio_4  -lsp_v2.0.2_d  -lw3emc_d  -lw3nco_d"

if (${1} == "debug" && ${2} == "32bit") then
  echo " debug w/ 32-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y DEBUG=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y DEBUG=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" 32BIT=Y -f Makefile_fv3)
else if (${1} == "debug" && ${2} != "32bit") then
  echo " debug w/ 64-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y DEBUG=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y DEBUG=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" -f Makefile_fv3)
else if (${1} == "repro" && ${2} == "32bit") then
  echo " repro w/ 32-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y REPRO=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y REPRO=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" 32BIT=Y -f Makefile_fv3)
else if (${1} == "repro" && ${2} != "32bit") then
  echo " repro w/ 64-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y REPRO=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y REPRO=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" -f Makefile_fv3)
else if (${1} == "prod" && ${2} == "32bit") then
  echo " prod w/ 32-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" 32BIT=Y -f Makefile_fv3)
else if (${1} == "prod" && ${2} != "32bit") then
  echo " prod w/ 64-bit dy-core"
    (cd exec ; make -j 8 OPENMP=Y AVX2=${3} -f Makefile_gfs)
    ifort -V
    (cd exec ; make -j 8 OPENMP=Y AVX2=${3} NETCDF=3 NCEPLIBS="${NCEPLIBS}" -f Makefile_fv3)
endif
